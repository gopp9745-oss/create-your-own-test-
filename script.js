// ==================== БАЗА ДАННЫХ ПРЕДМЕТОВ ====================
const subjectsByClass = {
    1: ['Математика', 'Русский язык', 'Окружающий мир'],
    2: ['Математика', 'Русский язык', 'Окружающий мир'],
    3: ['Математика', 'Русский язык', 'Окружающий мир'],
    4: ['Математика', 'Русский язык', 'Окружающий мир'],
    5: ['Математика', 'Русский язык', 'Литература', 'История', 'География', 'Биология'],
    6: ['Математика', 'Русский язык', 'Литература', 'История', 'География', 'Биология'],
    7: ['Алгебра', 'Геометрия', 'Русский язык', 'Литература', 'История', 'География', 'Биология', 'Физика'],
    8: ['Алгебра', 'Геометрия', 'Русский язык', 'Литература', 'История', 'География', 'Биология', 'Физика', 'Химия'],
    9: ['Алгебра', 'Геометрия', 'Русский язык', 'Литература', 'История', 'География', 'Биология', 'Физика', 'Химия'],
    10: ['Алгебра', 'Геометрия', 'Русский язык', 'Литература', 'История', 'География', 'Биология', 'Физика', 'Химия'],
    11: ['Алгебра', 'Геометрия', 'Русский язык', 'Литература', 'История', 'География', 'Биология', 'Физика', 'Химия']
};

// ==================== БАЗА ЗАДАНИЙ ПО КЛАССАМ И ПРЕДМЕТАМ ====================
const taskDatabase = {
    // ==================== МАТЕМАТИКА 1-4 КЛАСС ====================
    'Математика': {
        '1класс': {
            'сложение': {
                test: [
                    { text: 'Сколько будет 3 + 2?', answer: '5', options: ['5', '4', '6', '3'] },
                    { text: 'Сложи: 4 + 1', answer: '5', options: ['5', '3', '6', '4'] },
                    { text: '5 + 3 = ?', answer: '8', options: ['8', '7', '9', '6'] }
                ],
                independent: [
                    { text: 'Вычисли: 2 + 3 =', answer: '5' },
                    { text: 'Сложи: 1 + 4 =', answer: '5' }
                ]
            },
            'вычитание': {
                test: [
                    { text: 'Сколько будет 5 - 2?', answer: '3', options: ['3', '4', '2', '5'] },
                    { text: 'Вычитание: 7 - 3', answer: '4', options: ['4', '5', '3', '6'] }
                ],
                independent: [
                    { text: 'Вычисли: 4 - 2 =', answer: '2' }
                ]
            },
            'умножение': {
                test: [
                    { text: 'Сколько будет 2 × 3?', answer: '6', options: ['6', '5', '7', '4'] },
                    { text: '2 × 2 = ?', answer: '4', options: ['4', '3', '5', '6'] }
                ],
                independent: [
                    { text: 'Умножь: 2 × 4 =', answer: '8' }
                ]
            },
            'деление': {
                test: [
                    { text: 'Сколько будет 6 : 2?', answer: '3', options: ['3', '2', '4', '5'] },
                    { text: '8 : 2 = ?', answer: '4', options: ['4', '3', '5', '6'] }
                ],
                independent: [
                    { text: 'Раздели: 6 : 3 =', answer: '2' }
                ]
            },
            'сравнение': {
                test: [
                    { text: 'Что больше: 5 или 3?', answer: '5', options: ['5', '3', 'равны', 'не знаю'] },
                    { text: 'Сравните: 7 и 9', answer: '7 < 9', options: ['7 < 9', '7 > 9', '7 = 9'] }
                ],
                independent: [
                    { text: 'Сравните числа: 4 и 2', answer: '4 > 2' }
                ]
            },
            'геометрия': {
                test: [
                    { text: 'Сколько сторон у квадрата?', answer: '4', options: ['4', '3', '5', '6'] },
                    { text: 'Что такое круг?', answer: 'фигура без углов', options: ['фигура без углов', 'фигура с 3 углами', 'фигура с 4 углами'] }
                ],
                independent: [
                    { text: 'Нарисуйте треугольник и посчитайте его стороны', answer: '3 стороны' }
                ]
            }
        },
        '2класс': {
            'сложение': {
                test: [
                    { text: 'Вычислите: 25 + 13', answer: '38', options: ['38', '36', '40', '35'] },
                    { text: 'Сложите: 47 + 28', answer: '75', options: ['75', '65', '85', '70'] }
                ],
                independent: [
                    { text: 'Решите: 34 + 15 =', answer: '49' }
                ]
            },
            'вычитание': {
                test: [
                    { text: 'Вычислите: 56 - 23', answer: '33', options: ['33', '43', '30', '35'] },
                    { text: 'Вычитание: 74 - 38', answer: '36', options: ['36', '42', '38', '40'] }
                ],
                independent: [
                    { text: 'Решите: 82 - 47 =', answer: '35' }
                ]
            },
            'умножение': {
                test: [
                    { text: 'Умножьте: 3 × 7', answer: '21', options: ['21', '18', '24', '20'] },
                    { text: 'Сколько будет 5 × 4?', answer: '20', options: ['20', '25', '15', '18'] }
                ],
                independent: [
                    { text: 'Вычислите: 4 × 6 =', answer: '24' }
                ]
            },
            'деление': {
                test: [
                    { text: 'Разделите: 12 : 3', answer: '4', options: ['4', '3', '5', '6'] },
                    { text: 'Сколько будет 20 : 4?', answer: '5', options: ['5', '4', '6', '7'] }
                ],
                independent: [
                    { text: 'Вычислите: 18 : 6 =', answer: '3' }
                ]
            }
        },
        '3класс': {
            'умножение': {
                test: [
                    { text: 'Вычислите: 123 × 4', answer: '492', options: ['492', '482', '502', '472'] },
                    { text: 'Умножьте: 205 × 3', answer: '615', options: ['615', '625', '605', '595'] }
                ],
                independent: [
                    { text: 'Найдите произведение: 156 × 4 =', answer: '624' }
                ]
            },
            'деление': {
                test: [
                    { text: 'Вычислите: 96 : 8', answer: '12', options: ['12', '14', '10', '8'] },
                    { text: 'Найдите частное: 84 : 7', answer: '12', options: ['12', '14', '10', '11'] }
                ],
                independent: [
                    { text: 'Вычислите: 368 : 4 =', answer: '92' }
                ]
            },
            'дроби': {
                test: [
                    { text: 'Какая дробь больше: 1/2 или 1/3?', answer: '1/2', options: ['1/2', '1/3', 'равны'] },
                    { text: 'Запишите: три четвёртых', answer: '3/4', options: ['3/4', '4/3', '1/4', '3/4'] }
                ],
                independent: [
                    { text: 'Сравните: 2/5 и 3/5', answer: '2/5 < 3/5' }
                ]
            }
        },
        '4класс': {
            'умножение': {
                test: [
                    { text: 'Вычислите: 234 × 56', answer: '13104', options: ['13104', '12104', '14104', '13144'] },
                    { text: 'Умножьте: 123 × 48', answer: '5904', options: ['5904', '5804', '6004', '5900'] }
                ],
                independent: [
                    { text: 'Вычислите: 345 × 12 =', answer: '4140' }
                ]
            },
            'деление': {
                test: [
                    { text: 'Вычислите: 1440 : 12', answer: '120', options: ['120', '110', '130', '100'] },
                    { text: 'Найдите частное: 2856 : 8', answer: '357', options: ['357', '347', '367', '337'] }
                ],
                independent: [
                    { text: 'Вычислите: 5600 : 7 =', answer: '800' }
                ]
            },
            'дроби': {
                test: [
                    { text: 'Сложите: 1/2 + 1/4', answer: '3/4', options: ['3/4', '2/6', '1/2', '4/6'] },
                    { text: 'Умножьте: 2/3 × 1/2', answer: '1/3', options: ['1/3', '3/5', '2/5', '1/6'] }
                ],
                independent: [
                    { text: 'Вычислите: 3/5 - 1/5 =', answer: '2/5' }
                ]
            },
            'скорость': {
                test: [
                    { text: 'Скорость 60 км/ч. Какое расстояние за 2 часа?', answer: '120 км', options: ['120 км', '30 км', '180 км', '60 км'] },
                    { text: 'Расстояние 240 км, скорость 80 км/ч. Время?', answer: '3 часа', options: ['3 часа', '2 часа', '4 часа', '5 часов'] }
                ],
                independent: [
                    { text: 'Автомобиль ехал 4 часа со скоростью 70 км/ч. Найдите расстояние.', answer: '280 км' }
                ]
            }
        },
        '5класс': {
            'натуральные числа': {
                test: [
                    { text: 'Округлите 4567 до сотен', answer: '4600', options: ['4600', '4500', '4570', '4560'] },
                    { text: 'Сравните: 23001 и 23010', answer: '23001 < 23010', options: ['23001 < 23010', '23001 > 23010', 'равны'] }
                ],
                independent: [
                    { text: 'Запишите: пятьдесят две тысячи триста один', answer: '52301' }
                ]
            },
            'десятичные дроби': {
                test: [
                    { text: 'Сложите: 2,5 + 1,3', answer: '3,8', options: ['3,8', '3,7', '3,9', '2,8'] },
                    { text: 'Умножьте: 3,2 × 2', answer: '6,4', options: ['6,4', '6,2', '6,6', '6,0'] }
                ],
                independent: [
                    { text: 'Вычислите: 5,6 - 2,3 =', answer: '3,3' }
                ]
            },
            'обыкновенные дроби': {
                test: [
                    { text: 'Сложите: 1/2 + 1/4', answer: '3/4', options: ['3/4', '2/6', '1/2', '4/6'] },
                    { text: 'Умножьте: 2/3 × 3/5', answer: '2/5', options: ['2/5', '5/6', '6/15', '6/8'] }
                ],
                independent: [
                    { text: 'Вычислите: 3/5 - 1/5 =', answer: '2/5' }
                ]
            }
        },
        '6класс': {
            'отношения': {
                test: [
                    { text: 'Найдите отношение 8 к 2', answer: '4', options: ['4', '2', '6', '10'] },
                    { text: 'x/5 = 3/15, найдите x', answer: 'x = 1', options: ['x = 1', 'x = 5', 'x = 3', 'x = 15'] }
                ],
                independent: [
                    { text: 'Решите пропорцию: x/7 = 2/14', answer: 'x = 1' }
                ]
            },
            'отрицательные числа': {
                test: [
                    { text: 'Вычислите: -5 + 3', answer: '-2', options: ['-2', '2', '-8', '8'] },
                    { text: 'Вычислите: -7 × (-2)', answer: '14', options: ['14', '-14', '-9', '9'] }
                ],
                independent: [
                    { text: 'Вычислите: -8 + 5 =', answer: '-3' }
                ]
            },
            'координаты': {
                test: [
                    { text: 'Какая координата по оси X в точке (5, 3)?', answer: '5', options: ['5', '3', '0', '8'] },
                    { text: 'Где находится точка (0, 0)?', answer: 'в начале координат', options: ['в начале координат', 'на оси X', 'на оси Y', 'неизвестно'] }
                ],
                independent: [
                    { text: 'Постройте точку с координатами (4, 2)', answer: 'Проверка учителя' }
                ]
            }
        }
    },
    // ==================== АЛГЕБРА 7-11 КЛАСС ====================
    'Алгебра': {
        '7класс': {
            'выражения': {
                test: [
                    { text: 'Упростите: 3x + 5x - 2x', answer: '6x', options: ['6x', '10x', '8x', '6'] },
                    { text: 'Раскройте скобки: 3(x + 2)', answer: '3x + 6', options: ['3x + 6', '3x + 2', '3x - 6', 'x + 6'] }
                ],
                independent: [
                    { text: 'Упростите: 4x + 7 - 2x - 3', answer: '2x + 4' }
                ]
            },
            'уравнения': {
                test: [
                    { text: 'Решите уравнение: x + 5 = 12', answer: 'x = 7', options: ['x = 7', 'x = 17', 'x = 5', 'x = 60'] },
                    { text: 'Решите: 2x + 3 = 11', answer: 'x = 4', options: ['x = 4', 'x = 7', 'x = 14', 'x = 8'] }
                ],
                independent: [
                    { text: 'Решите: 3x - 4 = 8', answer: 'x = 4' }
                ]
            },
            'фсу': {
                test: [
                    { text: 'Раскройте: (x + 3)²', answer: 'x² + 6x + 9', options: ['x² + 6x + 9', 'x² + 9', 'x² + 6x + 6', 'x² + 3x + 9'] },
                    { text: 'Разложите: x² - 9', answer: '(x - 3)(x + 3)', options: ['(x - 3)(x + 3)', '(x - 9)(x + 1)', '(x - 3)²', '(x + 3)²'] }
                ],
                independent: [
                    { text: 'Раскройте: (x + 2)²', answer: 'x² + 4x + 4' }
                ]
            },
            'функции': {
                test: [
                    { text: 'Найдите y, если y = 2x и x = 3', answer: 'y = 6', options: ['y = 6', 'y = 5', 'y = 8', 'y = 4'] },
                    { text: 'Что является графиком функции y = kx + b?', answer: 'прямая', options: ['прямая', 'парабола', 'гипербола', 'окружность'] }
                ],
                independent: [
                    { text: 'Постройте график функции y = 2x + 1', answer: 'Проверка' }
                ]
            }
        },
        '8класс': {
            'квадратные уравнения': {
                test: [
                    { text: 'Решите: x² - 5x + 6 = 0', answer: 'x = 2 или x = 3', options: ['x = 2 или x = 3', 'x = 1 или x = 6', 'нет решений'] },
                    { text: 'Найдите дискриминант: x² + 4x + 3 = 0', answer: 'D = 4', options: ['D = 4', 'D = 16', 'D = 8', 'D = 2'] }
                ],
                independent: [
                    { text: 'Решите: x² - 9 = 0', answer: 'x = 3 или x = -3' }
                ]
            },
            'неравенства': {
                test: [
                    { text: 'Решите: x + 3 > 7', answer: 'x > 4', options: ['x > 4', 'x < 4', 'x = 4', 'x ≥ 4'] },
                    { text: 'Решите: 2x ≤ 10', answer: 'x ≤ 5', options: ['x ≤ 5', 'x ≥ 5', 'x < 5', 'x = 5'] }
                ],
                independent: [
                    { text: 'Решите: x - 5 < 3', answer: 'x < 8' }
                ]
            },
            'степени': {
                test: [
                    { text: 'Вычислите: 2⁴', answer: '16', options: ['16', '8', '32', '64'] },
                    { text: 'Представьте в виде степени: x⁵ × x³', answer: 'x⁸', options: ['x⁸', 'x¹⁵', 'x²', 'x⁵'] }
                ],
                independent: [
                    { text: 'Вычислите: 3² × 3¹ =', answer: '27' }
                ]
            }
        },
        '9класс': {
            'квадратичная функция': {
                test: [
                    { text: 'Найдите вершину параболы y = x² - 4x + 3', answer: '(2, -1)', options: ['(2, -1)', '(2, 1)', '(4, -1)', '(4, 1)'] },
                    { text: 'Определите направление ветвей: y = -2x²', answer: 'вниз', options: ['вниз', 'вверх', 'вправо', 'влево'] }
                ],
                independent: [
                    { text: 'Найдите нули функции: x² - 4 = 0', answer: 'x = 2 или x = -2' }
                ]
            },
            'прогрессии': {
                test: [
                    { text: 'Найдите 5-й член арифметической прогрессии: 2, 5, 8...', answer: '14', options: ['14', '11', '17', '13'] },
                    { text: 'Найдите 4-й член геометрической прогрессии: 2, 4, 8...', answer: '16', options: ['16', '12', '10', '8'] }
                ],
                independent: [
                    { text: 'Дано: a₁ = 3, d = 2. Найдите a₁₀', answer: 'a₁₀ = 21' }
                ]
            }
        },
        '10класс': {
            'тригонометрия': {
                test: [
                    { text: 'Чему равен sin 90°?', answer: '1', options: ['1', '0', '-1', '0.5'] },
                    { text: 'cos 0° = ?', answer: '1', options: ['1', '0', '-1', '0.5'] }
                ],
                independent: [
                    { text: 'Вычислите: sin 30° + cos 60°', answer: '1' }
                ]
            },
            'производная': {
                test: [
                    { text: 'Найдите производную: y = x²', answer: "y' = 2x", options: ["y' = 2x", "y' = x", "y' = 2", "y' = x²"] },
                    { text: 'Производная константы равна:', answer: '0', options: ['0', '1', 'константе', 'не существует'] }
                ],
                independent: [
                    { text: 'Найдите производную функции y = 3x + 5', answer: "y' = 3" }
                ]
            }
        },
        '11класс': {
            'интегралы': {
                test: [
                    { text: '∫ dx = ?', answer: 'x + C', options: ['x + C', '1 + C', 'x² + C', '0 + C'] },
                    { text: '∫ x dx = ?', answer: 'x²/2 + C', options: ['x²/2 + C', 'x + C', 'x² + C', '1/2x + C'] }
                ],
                independent: [
                    { text: 'Вычислите: ∫ 2x dx', answer: 'x² + C' }
                ]
            },
            'логарифмы': {
                test: [
                    { text: 'log₂ 8 = ?', answer: '3', options: ['3', '2', '4', '8'] },
                    { text: 'ln e = ?', answer: '1', options: ['1', 'e', '0', 'ln1'] }
                ],
                independent: [
                    { text: 'Вычислите: log₃ 9', answer: '2' }
                ]
            }
        }
    },
    // ==================== ГЕОМЕТРИЯ ====================
    'Геометрия': {
        '7класс': {
            'треугольники': {
                test: [
                    { text: 'Чему равна сумма углов треугольника?', answer: '180°', options: ['180°', '360°', '90°', '270°'] },
                    { text: 'Стороны треугольника 3, 4, 5. Какой это треугольник?', answer: 'прямоугольный', options: ['прямоугольный', 'остроугольный', 'тупоугольный', 'равнобедренный'] },
                    { text: 'В равнобедренном треугольнике угол при вершине 40°. Найдите углы при основании.', answer: '70° и 70°', options: ['70° и 70°', '40° и 40°', '70° и 40°'] }
                ],
                independent: [
                    { text: 'Найдите третий угол треугольника, если два угла 45° и 55°', answer: '80°' }
                ]
            },
            'параллельные прямые': {
                test: [
                    { text: 'Сумма односторонних углов при параллельных прямых = ?', answer: '180°', options: ['180°', '90°', '360°', '0°'] },
                    { text: 'Если соответственные углы равны, то прямые...', answer: 'параллельны', options: ['параллельны', 'перпендикулярны', 'пересекаются', 'совпадают'] }
                ],
                independent: [
                    { text: 'Дано: ∠1 = 70°, ∠2 = 110°. Параллельны ли прямые?', answer: 'да' }
                ]
            }
        },
        '8класс': {
            'четырёхугольники': {
                test: [
                    { text: 'Сумма углов выпуклого четырёхугольника?', answer: '360°', options: ['360°', '180°', '540°', '720°'] },
                    { text: 'В параллелограмме противоположные углы...', answer: 'равны', options: ['равны', 'в сумме 180°', 'в сумме 360°', 'прямые'] },
                    { text: 'Ромб - это...', answer: 'параллелограмм с равными сторонами', options: ['параллелограмм с равными сторонами', 'прямоугольник', 'квадрат', 'трапеция'] }
                ],
                independent: [
                    { text: 'В параллелограмме стороны 5 и 8. Найдите периметр.', answer: 'P = 26' }
                ]
            },
            'площадь': {
                test: [
                    { text: 'Площадь квадрата 64 см². Чему равна сторона?', answer: '8 см', options: ['8 см', '6 см', '7 см', '9 см'] },
                    { text: 'Площадь прямоугольника 40 см², ширина 5 см. Найдите длину.', answer: '8 см', options: ['8 см', '6 см', '10 см', '7 см'] }
                ],
                independent: [
                    { text: 'Найдите площадь треугольника с основанием 10 см и высотой 6 см.', answer: '30 см²' }
                ]
            }
        },
        '9класс': {
            'векторы': {
                test: [
                    { text: 'Длина вектора (3, 4) = ?', answer: '5', options: ['5', '7', '12', '25'] },
                    { text: 'Сумма векторов (1,2) + (3,4) = ?', answer: '(4,6)', options: ['(4,6)', '(2,6)', '(4,8)', '(2,2)'] }
                ],
                independent: [
                    { text: 'Найдите длину вектора (6, 8)', answer: '10' }
                ]
            },
            'окружность': {
                test: [
                    { text: 'Формула длины окружности:', answer: 'C = 2πR', options: ['C = 2πR', 'C = πR²', 'C = πD', 'C = R²'] },
                    { text: 'Площадь круга: S = ?', answer: 'πR²', options: ['πR²', '2πR', 'πD', 'R²'] }
                ],
                independent: [
                    { text: 'Найдите длину окружности радиусом 5 см (π ≈ 3,14)', answer: '≈31,4 см' }
                ]
            }
        },
        '10класс': {
            'стереометрия': {
                test: [
                    { text: 'Сколько граней у куба?', answer: '6', options: ['6', '8', '12', '4'] },
                    { text: 'Призма имеет 5 граней. Сколько у неё вершин?', answer: '10', options: ['10', '8', '6', '12'] }
                ],
                independent: [
                    { text: 'Нарисуйте тетраэдр и укажите количество его рёбер', answer: '6 рёбер' }
                ]
            }
        },
        '11класс': {
            'объёмы': {
                test: [
                    { text: 'Объём куба со стороной 3 см = ?', answer: '27 см³', options: ['27 см³', '9 см³', '18 см³', '36 см³'] },
                    { text: 'Объём шара: V = ?', answer: '4/3πR³', options: ['4/3πR³', 'πR²', '2πR³', 'πR³'] }
                ],
                independent: [
                    { text: 'Найдите объём цилиндра с радиусом 2 и высотой 5', answer: '20π' }
                ]
            }
        }
    },
    // ==================== ФИЗИКА ====================
    'Физика': {
        '7класс': {
            'механическое движение': {
                test: [
                    { text: 'Переведите 72 км/ч в м/с', answer: '20 м/с', options: ['20 м/с', '25 м/с', '15 м/с', '30 м/с'] },
                    { text: 'Формула скорости:', answer: 'v = s/t', options: ['v = s/t', 'v = st', 'v = t/s', 'v = s + t'] }
                ],
                independent: [
                    { text: 'Расстояние 240 км, скорость 80 км/ч. Время?', answer: '3 часа' }
                ]
            },
            'сила': {
                test: [
                    { text: 'Единица измерения силы?', answer: 'Ньютон (Н)', options: ['Ньютон (Н)', 'Килограмм (кг)', 'Метр (м)', 'Ватт (Вт)'] },
                    { text: 'F = ma. Если m = 5 кг, a = 2 м/с², то F = ?', answer: '10 Н', options: ['10 Н', '7 Н', '3 Н', '2,5 Н'] }
                ],
                independent: [
                    { text: 'Найдите силу, действующую на тело массой 10 кг с ускорением 2 м/с²', answer: '20 Н' }
                ]
            },
            'давление': {
                test: [
                    { text: 'Формула давления:', answer: 'p = F/S', options: ['p = F/S', 'p = F·S', 'p = S/F', 'p = F + S'] },
                    { text: 'Давление = 100 Па, площадь = 2 м². Сила F = ?', answer: '200 Н', options: ['200 Н', '50 Н', '100 Н', '400 Н'] }
                ],
                independent: [
                    { text: 'Рассчитайте давление тела весом 100 Н на площадь 0,5 м²', answer: '200 Па' }
                ]
            }
        },
        '8класс': {
            'тепловые явления': {
                test: [
                    { text: 'Формула количества теплоты: Q = ...', answer: 'cm(t₂ - t₁)', options: ['cm(t₂ - t₁)', 'mgh', 'mv²/2', 'F/s'] },
                    { text: 'Удельная теплоёмкость воды:', answer: '4200 Дж/(кг·°С)', options: ['4200 Дж/(кг·°С)', '2100 Дж/(кг·°С)', '420 Дж/(кг·°С)'] }
                ],
                independent: [
                    { text: 'Какое количество теплоты нужно для нагрева 2 кг воды на 10°С?', answer: 'Q = 84 кДж' }
                ]
            },
            'электричество': {
                test: [
                    { text: 'Закон Ома:', answer: 'I = U/R', options: ['I = U/R', 'I = UR', 'I = R/U', 'I = U + R'] },
                    { text: 'Мощность тока P = ...', answer: 'UI', options: ['UI', 'U/I', 'I/R', 'R/I'] }
                ],
                independent: [
                    { text: 'Найдите силу тока: U = 12 В, R = 4 Ом', answer: 'I = 3 А' }
                ]
            },
            'свет': {
                test: [
                    { text: 'Угол падения равен углу...', answer: 'отражения', options: ['отражения', 'преломления', 'падения', 'дифракции'] },
                    { text: 'Фокусное расстояние линзы 10 см. Оптическая сила D = ?', answer: '10 дптр', options: ['10 дптр', '0,1 дптр', '100 дптр', '1 дптр'] }
                ],
                independent: [
                    { text: 'Постройте изображение предмета в собирающей линзе', answer: 'Проверка' }
                ]
            }
        },
        '9класс': {
            'законы Ньютона': {
                test: [
                    { text: '1 закон Ньютона: тело движется...', answer: 'равномерно или покоится', options: ['равномерно или покоится', 'ускоренно', 'замедленно', 'по окружности'] },
                    { text: '2 закон Ньютона: F = ?', answer: 'ma', options: ['ma', 'mv', 'm/a', 'm + a'] }
                ],
                independent: [
                    { text: 'На тело массой 2 кг действует сила 10 Н. Найдите ускорение.', answer: '5 м/с²' }
                ]
            },
            'звук': {
                test: [
                    { text: 'Скорость звука в воздухе около:', answer: '340 м/с', options: ['340 м/с', '3000 м/с', '34 м/с', '300000 км/с'] },
                    { text: 'Частота звука измеряется в:', answer: 'Гц', options: ['Гц', 'м/с', 'Дж', 'Вт'] }
                ],
                independent: [
                    { text: 'Рассчитайте длину волны, если частота 100 Гц, скорость 340 м/с', answer: '3,4 м' }
                ]
            }
        },
        '10класс': {
            'молекулярная физика': {
                test: [
                    { text: 'Уравнение Менделеева-Клапейрона:', answer: 'pV = nRT', options: ['pV = nRT', 'pV = mRT/M', 'pV = const', 'оба верны'] },
                    { text: 'Изобарный процесс: V/T = ?', answer: 'const', options: ['const', 'p/T', 'pV', 'T/V'] }
                ],
                independent: [
                    { text: 'Газ при температуре 300 К занимает объём 10 л. Какой объём при 600 К?', answer: '20 л' }
                ]
            }
        },
        '11класс': {
            'электромагнетизм': {
                test: [
                    { text: 'Сила Ампера: F = ?', answer: 'BIL sinα', options: ['BIL sinα', 'qE', 'Bqv', 'kq₁q₂/r²'] },
                    { text: 'ЭДС индукции: ε = ?', answer: '-dФ/dt', options: ['-dФ/dt', 'IR', 'BLv', 'U/q'] }
                ],
                independent: [
                    { text: 'Магнитный поток через контур изменился на 0,1 Вб за 0,1 с. Найдите ЭДС.', answer: '1 В' }
                ]
            },
            'квантовая физика': {
                test: [
                    { text: 'Формула Эйнштейна для фотоэффекта:', answer: 'E = hν - A', options: ['E = hν - A', 'E = mc²', 'E = hf', 'E = A + hf'] },
                    { text: 'Постоянная Планка h = ?', answer: '6,626·10⁻³⁴ Дж·с', options: ['6,626·10⁻³⁴ Дж·с', '6,626·10⁻³⁴', '1,6·10⁻¹⁹', '9,1·10⁻³¹'] }
                ],
                independent: [
                    { text: 'Энергия фотона с частотой 6·10¹⁴ Гц (h = 6,6·10⁻³⁴)', answer: '≈4·10⁻¹⁹ Дж' }
                ]
            }
        }
    },
    // ==================== ХИМИЯ ====================
    'Химия': {
        '8класс': {
            'атомы': {
                test: [
                    { text: 'Атом состоит из...', answer: 'ядра и электронов', options: ['ядра и электронов', 'только ядра', 'молекул', 'протонов'] },
                    { text: 'Число протонов в атоме = ...', answer: 'порядковому номеру', options: ['порядковому номеру', 'атомной массе', 'числу нейтронов'] }
                ],
                independent: [
                    { text: 'Сколько электронов в атоме кислорода (O)?', answer: '8' }
                ]
            },
            'химические реакции': {
                test: [
                    { text: 'Расставьте коэффициенты: Fe + O₂ → Fe₂O₃', answer: '4Fe + 3O₂ → 2Fe₂O₃', options: ['4Fe + 3O₂ → 2Fe₂O₃', 'Fe + O₂ → Fe₂O₃'] },
                    { text: 'Тип реакции: CaO + H₂O → Ca(OH)₂', answer: 'соединения', options: ['соединения', 'разложения', 'замещения', 'обмена'] }
                ],
                independent: [
                    { text: 'Расставьте коэффициенты: Al + O₂ → Al₂O₃', answer: '4Al + 3O₂ → 2Al₂O₃' }
                ]
            },
            'периодический закон': {
                test: [
                    { text: 'Сколько периодов в таблице Менделеева?', answer: '7', options: ['7', '8', '6', '9'] },
                    { text: 'Группа содержит элементы с...', answer: 'одинаковым числом валентных электронов', options: ['одинаковым числом валентных электронов', 'одинаковым числом электронных слоёв'] }
                ],
                independent: [
                    { text: 'Напишите электронную конфигурацию натрия (Na)', answer: '1s² 2s² 2p⁶ 3s¹' }
                ]
            }
        },
        '9класс': {
            'электролитическая диссоциация': {
                test: [
                    { text: 'Электролиты - это вещества, которые...', answer: 'проводят ток в растворе', options: ['проводят ток в растворе', 'не проводят ток', 'являются изоляторами'] },
                    { text: 'Ионы - это...', answer: 'заряженные частицы', options: ['заряженные частицы', 'нейтральные частицы', 'атомы'] }
                ],
                independent: [
                    { text: 'Напишите уравнение диссоциации NaCl', answer: 'NaCl → Na⁺ + Cl⁻' }
                ]
            },
            'металлы': {
                test: [
                    { text: 'Какой металл самый активный?', answer: 'K (калий)', options: ['K (калий)', 'Na', 'Ca', 'Mg'] },
                    { text: 'Железо реагирует с:', answer: 'HCl, O₂', options: ['HCl, O₂', 'только с O₂', 'только с HCl'] }
                ],
                independent: [
                    { text: 'Напишите реакцию железа с соляной кислотой', answer: 'Fe + 2HCl → FeCl₂ + H₂' }
                ]
            }
        },
        '10класс': {
            'органическая химия': {
                test: [
                    { text: 'Метан имеет формулу:', answer: 'CH₄', options: ['CH₄', 'C₂H₆', 'C₃H₈', 'C₂H₄'] },
                    { text: 'Гомологи - это вещества, отличающиеся на:', answer: 'CH₂', options: ['CH₂', 'CH₃', 'OH', 'H'] }
                ],
                independent: [
                    { text: 'Напишите структурную формулу этана', answer: 'H₃C-CH₃' }
                ]
            },
            'углеводороды': {
                test: [
                    { text: 'Алканы имеют связь:', answer: 'одинарную', options: ['одинарную', 'двойную', 'тройную'] },
                    { text: 'Бензол имеет формулу:', answer: 'C₆H₆', options: ['C₆H₆', 'C₆H₁₂', 'C₆H₆ (цикл)', 'C₆H₁₀'] }
                ],
                independent: [
                    { text: 'Назовите: CH₃-CH₂-CH₃', answer: 'пропан' }
                ]
            }
        },
        '11класс': {
            'биохимия': {
                test: [
                    { text: 'Белки состоят из:', answer: 'аминокислот', options: ['аминокислот', 'глюкозы', 'жирных кислот', 'нуклеотидов'] },
                    { text: 'Жиры - это сложные эфиры глицерина и:', answer: 'жирных кислот', options: ['жирных кислот', 'спиртов', 'углеводов'] }
                ],
                independent: [
                    { text: 'Напишите формулу глюкозы', answer: 'C₆H₁₂O₆' }
                ]
            },
            'высокомолекулярные соединения': {
                test: [
                    { text: 'Полимеры - это...', answer: 'вещества из повторяющихся звеньев', options: ['вещества из повторяющихся звеньев', 'кристаллические тела'] },
                    { text: 'Мономер - это...', answer: 'исходное вещество для полимера', options: ['исходное вещество для полимера', 'полимер'] }
                ],
                independent: [
                    { text: 'Из чего получают полиэтилен?', answer: 'из этилена (CH₂=CH₂)' }
                ]
            }
        }
    },
    // ==================== РУССКИЙ ЯЗЫК ====================
    'Русский язык': {
        '5класс': {
            'части речи': {
                test: [
                    { text: 'Какое это слово: "бежать"?', answer: 'глагол', options: ['глагол', 'существительное', 'прилагательное', 'наречие'] },
                    { text: 'Найдите существительное:', answer: 'книга', options: ['книга', 'красивый', 'быстро', 'бежать'] }
                ],
                independent: [
                    { text: 'Определите часть речи слова "интересный"', answer: 'прилагательное' }
                ]
            },
            'предложение': {
                test: [
                    { text: 'Главные члены предложения:', answer: 'подлежащее и сказуемое', options: ['подлежащее и сказуемое', 'второстепенные', 'дополнения'] },
                    { text: 'Сколько грамматических основ может быть в сложном предложении?', answer: 'две и более', options: ['две и более', 'одна', 'три'] }
                ],
                independent: [
                    { text: 'Разберите предложение по членам: "Девочка читает книгу"', answer: 'Девочка (подл.), читает (сказ.), книгу (доп.)' }
                ]
            }
        },
        '6класс': {
            'имя существительное': {
                test: [
                    { text: 'Склонение "река"?', answer: '1-е склонение', options: ['1-е склонение', '2-е склонение', '3-е склонение'] },
                    { text: 'Падеж "в школе":', answer: 'предложный', options: ['предложный', 'родительный', 'дательный'] }
                ],
                independent: [
                    { text: 'Просклоняйте слово "гора"', answer: 'гора - горы - горе - гору - горой - о горе' }
                ]
            },
            'имя прилагательное': {
                test: [
                    { text: 'Прилагательное согласуется с:', answer: 'существительным', options: ['существительным', 'глаголом', 'наречием'] },
                    { text: 'Краткая форма прилагательного: "дом высокий" - "дом..."?', answer: 'высок', options: ['высок', 'высокий', 'высочайший'] }
                ],
                independent: [
                    { text: 'Образуйте краткую форму: "новый" - "нов"', answer: 'нов' }
                ]
            },
            'глагол': {
                test: [
                    { text: 'Спряжение "читать"?', answer: '1 спряжение', options: ['1 спряжение', '2 спряжение'] },
                    { text: 'Глагол "написать" - вид:', answer: 'совершенный', options: ['совершенный', 'несовершенный'] }
                ],
                independent: [
                    { text: 'Образуйте форму 2-го лица мн.ч. глагола "быть"', answer: 'будете' }
                ]
            }
        },
        '7класс': {
            'причастие': {
                test: [
                    { text: 'Найдите причастие: "Машина, остановленная водителем..."', answer: 'остановленная', options: ['остановленная', 'стояла', 'машина'] },
                    { text: 'Причастие - это...', answer: 'особая форма глагола', options: ['особая форма глагола', 'вид прилагательного', 'наречие'] }
                ],
                independent: [
                    { text: 'Выпишите причастия из предложения', answer: 'Проверка' }
                ]
            },
            'деепричастие': {
                test: [
                    { text: 'Найдите деепричастие:', answer: 'читая', options: ['читая', 'читающий', 'прочитал'] },
                    { text: 'Деепричастный оборот выделяется:', answer: 'запятыми', options: ['запятыми', 'скобками', 'тире'] }
                ],
                independent: [
                    { text: 'Расставьте запятые: "Он шёл улыбаясь"', answer: 'Он шёл, улыбаясь.' }
                ]
            }
        },
        '8класс': {
            'однородные члены': {
                test: [
                    { text: 'Однородные члены связываются...', answer: 'союзами или запятыми', options: ['союзами или запятыми', 'только союзами', 'только запятыми'] },
                    { text: 'Обобщающее слово при однородных членах:', answer: 'все, никто, всё', options: ['все, никто, всё', 'только "все"'] }
                ],
                independent: [
                    { text: 'Расставьте знаки препинания: "Пошли мы в лес и в поле и реку"', answer: 'Пошли мы в лес, и в поле, и в реку.' }
                ]
            },
            'обособленные члены': {
                test: [
                    { text: 'Обособляются запятыми:', answer: 'определения с зависимыми словами', options: ['определения с зависимыми словами', 'только приложения'] },
                    { text: 'Сравнительный оборот выделяется:', answer: 'запятыми', options: ['запятыми', 'тире', 'скобками'] }
                ],
                independent: [
                    { text: 'Подчеркните обособленные члены: "Усталый, я лёг отдыхать"', answer: 'Усталый (обособлено), я лёг отдыхать.' }
                ]
            }
        },
        '9класс': {
            'сложное предложение': {
                test: [
                    { text: 'Сложносочинённое предложение имеет:', answer: '2+ грамматические основы и союз', options: ['2+ основы и союз', '2 основы без союза'] },
                    { text: 'Союзы "что, потому что, если" связывают части:', answer: 'сложноподчинённого предложения', options: ['сложноподчинённого', 'сложносочинённого'] }
                ],
                independent: [
                    { text: 'Определите тип: "Я вышел, когда солнце садилось"', answer: 'сложноподчинённое' }
                ]
            },
            'прямая речь': {
                test: [
                    { text: 'Прямая речь выделяется:', answer: 'кавычками', options: ['кавычками', 'скобками', 'тире'] },
                    { text: 'После слов автора ставится:', answer: 'двоеточие или запятая', options: ['двоеточие или запятая', 'только двоеточие'] }
                ],
                independent: [
                    { text: 'Оформите: Он сказал: "Я приду завтра"', answer: 'Он сказал: "Я приду завтра".' }
                ]
            }
        },
        '10класс': {
            'морфология': {
                test: [
                    { text: 'Служебные части речи:', answer: 'предлог, союз, частица', options: ['предлог, союз, частица', 'только предлог и союз'] },
                    { text: 'Частица НЕ пишется раздельно с:', answer: 'глаголами, причастиями', options: ['глаголами, причастиями', 'существительными'] }
                ],
                independent: [
                    { text: 'Объясните написание: "не был" (раздельно)', answer: 'глагол с "не" пишется раздельно' }
                ]
            },
            'правописание': {
                test: [
                    { text: 'В суффиксе -ова-/-ева- пишется:', answer: '-ова-', options: ['-ова-', '-ева-', зависит от значения'] },
                    { text: 'Н и НН в причастиях: "крашеННый" или "крашеНый"?', answer: 'крашеННый (полное причастие)', options: ['крашеННый', 'крашеНый'] }
                ],
                independent: [
                    { text: 'Расставьте Н/НН: "Ветре_ый день, жжё_ый костёр"', answer: 'ветреный, жжёный' }
                ]
            }
        },
        '11класс': {
            'синтаксис': {
                test: [
                    { text: 'Активные конструкции используются, когда...', answer: 'субъект выполняет действие', options: ['субъект выполняет действие', 'субъект подвергается действию'] },
                    { text: 'Пассивные конструкции: подлежащее...', answer: 'объект действия', options: ['объект действия', 'субъект действия'] }
                ],
                independent: [
                    { text: 'Перестройте в пассив: "Строители построили дом"', answer: 'Дом был построен строителями.' }
                ]
            },
            'текст': {
                test: [
                    { text: 'Стили речи:', answer: 'научный, публицистический, художественный, разговорный, официально-деловой', options: ['4 стиля', '5 стилей'] },
                    { text: 'Публицистический стиль используется в:', answer: 'статьях, репортажах', options: ['статьях, репортажах', 'учебниках', 'художественных произведениях'] }
                ],
                independent: [
                    { text: 'Определите стиль: "В соответствии с законом..."', answer: 'официально-деловой' }
                ]
            }
        }
    },
    // ==================== БИОЛОГИЯ ====================
    'Биология': {
        '5класс': {
            'растения': {
                test: [
                    { text: 'Органы растения:', answer: 'корень, стебель, лист, цветок', options: ['3 органа', '4 органа', '5 органов'] },
                    { text: 'Фотосинтез происходит в:', answer: 'листьях', options: ['листьях', 'корне', 'стебле'] }
                ],
                independent: [
                    { text: 'Перечислите части цветка', answer: 'чашелистики, лепестки, тычинки, пестик' }
                ]
            },
            'бактерии': {
                test: [
                    { text: 'Бактерии - это...', answer: 'одноклеточные организмы без ядра', options: ['без ядра', 'многоклеточные', 'вирусы'] },
                    { text: 'Бактерии размножаются:', answer: 'делением', options: ['делением', 'спорами', 'половым путём'] }
                ],
                independent: [
                    { text: 'Приведите пример бактерии', answer: 'кишечная палочка, стафилококк и др.' }
                ]
            }
        },
        '6класс': {
            'строение клетки': {
                test: [
                    { text: 'Ядро содержится в:', answer: 'эукариотической клетке', options: ['эукариотической', 'прокариотической', 'обеих'] },
                    { text: 'Хлоропласты отвечают за:', answer: 'фотосинтез', options: ['фотосинтез', 'дыхание', 'деление'] }
                ],
                independent: [
                    { text: 'Нарисуйте растительную клетку и подпишите органоиды', answer: 'Проверка' }
                ]
            },
            'жизнедеятельность растений': {
                test: [
                    { text: 'Вода испаряется через:', answer: 'устьица', options: ['устьица', 'чечевички', 'корни'] },
                    { text: 'Для фотосинтеза необходим(ы):', answer: 'свет, вода, CO₂', options: ['свет', 'только вода', 'свет, вода, CO₂'] }
                ],
                independent: [
                    { text: 'Объясните процесс фотосинтеза', answer: 'Преобразование света в химическую энергию' }
                ]
            }
        },
        '7класс': {
            'животные': {
                test: [
                    { text: 'К какому типу относятся рыбы?', answer: 'Хордовые', options: ['Хордовые', 'Членистоногие', 'Моллюски'] },
                    { text: 'Какой орган дыхания у рыб?', answer: 'жабры', options: ['жабры', 'лёгкие', 'трахея'] }
                ],
                independent: [
                    { text: 'Перечислите системы органов рыб', answer: 'пищеварительная, дыхательная, кровеносная, нервная, выделительная' }
                ]
            },
            'типы животных': {
                test: [
                    { text: 'Млекопитающие - это...', answer: 'теплокровные позвоночные с шерстью', options: ['теплокровные', 'холоднокровные'] },
                    { text: 'Птицы откладывают яйца, потому что они:', answer: 'яйцекладущие', options: ['яйцекладущие', 'живородящие'] }
                ],
                independent: [
                    { text: 'Сравните земноводных и пресмыкающихся', answer: 'Таблица' }
                ]
            }
        },
        '8класс': {
            'человек': {
                test: [
                    { text: 'Какой орган - "насос"?', answer: 'сердце', options: ['сердце', 'печень', 'лёгкие', 'мозг'] },
                    { text: 'Сколько костей в скелете взрослого человека?', answer: '≈206', options: ['≈206', '≈100', '≈300'] }
                ],
                independent: [
                    { text: 'Нарисуйте и подпишите основные системы органов человека', answer: 'Проверка' }
                ]
            },
            'системы органов': {
                test: [
                    { text: 'Кровь переносит:', answer: 'кислород и питательные вещества', options: ['кислород', 'только питательные вещества'] },
                    { text: 'Нервная система управляет:', answer: 'всеми функциями организма', options: ['всеми функциями', 'только движением'] }
                ],
                independent: [
                    { text: 'Опишите механизм дыхания', answer: 'Вдох - диафрагма опускается, лёгкие расширяются' }
                ]
            }
        },
        '9класс': {
            'эволюция': {
                test: [
                    { text: 'Теория эволюции Дарвина утверждает, что...', answer: 'виды изменяются и приспосабливаются', options: ['виды изменяются', 'виды неизменны'] },
                    { text: 'Естественный отбор - это...', answer: 'выживание наиболее приспособленных', options: ['случайный отбор', 'искусственный отбор'] }
                ],
                independent: [
                    { text: 'Приведите примеры естественного отбора', answer: 'Изменение окраски бабочек, длин шеи у жирафов' }
                ]
            },
            'генетика': {
                test: [
                    { text: 'Гены находятся в:', answer: 'хромосомах', options: ['хромосомах', 'цитоплазме', 'рибосомах'] },
                    { text: 'Генотип - это...', answer: 'набор генов организма', options: ['набор генов', 'внешний вид'] }
                ],
                independent: [
                    { text: 'Решите задачу: скрещивание гомозигот AA × aa', answer: 'все потомки Aa' }
                ]
            }
        },
        '10класс': {
            'биохимия': {
                test: [
                    { text: 'АТФ - это...', answer: 'источник энергии', options: ['источник энергии', 'структура клетки'] },
                    { text: 'Ферменты - это...', answer: 'белки-катализаторы', options: ['белки-катализаторы', 'углеводы'] }
                ],
                independent: [
                    { text: 'Объясните роль АТФ в клетке', answer: 'Переносчик энергии' }
                ]
            },
            'митоз': {
                test: [
                    { text: 'В результате митоза образуется:', answer: '2 клетки с диплоидным набором', options: ['2 клетки', '4 клетки'] },
                    { text: 'Хромосомы удваиваются в:', answer: 'интерфазу', options: ['интерфазу', 'профазу', 'метафазу'] }
                ],
                independent: [
                    { text: 'Опишите фазы митоза', answer: 'Профаза, метафаза, анафаза, телофаза' }
                ]
            }
        },
        '11класс': {
            'экосистемы': {
                test: [
                    { text: 'Биогеоценоз - это...', answer: 'совокупность живых организмов и среды', options: ['совокупность', 'один вид'] },
                    { text: 'Продуценты в экосистеме:', answer: 'производители органических веществ', options: ['производители', 'потребители', 'разлагатели'] }
                ],
                independent: [
                    { text: 'Составьте цепь питания', answer: 'Трава → кузнечик → лягушка → змея → орёл' }
                ]
            },
            'биосфера': {
                test: [
                    { text: 'Биосфера - это...', answer: 'область распространения жизни', options: ['область жизни', 'планета'] },
                    { text: 'Воздействие человека на природу:', answer: 'антропогенное', options: ['антропогенное', 'естественное'] }
                ],
                independent: [
                    { text: 'Приведите примеры антропогенного воздействия', answer: 'Загрязнение, вырубка лесов, охота' }
                ]
            }
        }
    },
    // ==================== ИСТОРИЯ ====================
    'История': {
        'default': {
            test: [
                { text: 'В каком году была Куликовская битва?', answer: '1380', options: ['1380', '1480', '1280', '1180'] },
                { text: 'Кто был первым русским царём?', answer: 'Иван IV Грозный', options: ['Иван IV Грозный', 'Пётр I', 'Иван III'] },
                { text: 'Назовите дату начала ВОВ', answer: '22 июня 1941', options: ['22 июня 1941', '1 сентября 1939'] }
            ],
            independent: [
                { text: 'Подготовьте сообщение о полководце ВОВ', answer: 'Творческое задание' }
            ],
            control: [
                { text: 'Напишите эссе о значимом историческом событии', answer: 'Оценивается' }
            ]
        }
    },
    // ==================== ГЕОГРАФИЯ ====================
    'География': {
        'default': {
            test: [
                { text: 'Самая длинная река в мире?', answer: 'Нил', options: ['Нил', 'Амазонка', 'Волга'] },
                { text: 'Сколько материков на Земле?', answer: '6', options: ['6', '5', '7'] },
                { text: 'Самая высокая гора мира?', answer: 'Эверест', options: ['Эверест', 'К2', 'Эльбрус'] }
            ],
            independent: [
                { text: 'Опишите географическое положение России', answer: 'Творческое задание' }
            ],
            control: [
                { text: 'Подготовьте доклад о природной зоне России', answer: 'Оценивается' }
            ]
        }
    },
    // ==================== ЛИТЕРАТУРА ====================
    'Литература': {
        'default': {
            test: [
                { text: 'Кто написал "Евгений Онегин"?', answer: 'А.С. Пушкин', options: ['Пушкин', 'Гоголь', 'Толстой', 'Достоевский'] },
                { text: 'Сколько томов в "Войне и мир"?', answer: '4', options: ['4', '2', '5', '3'] }
            ],
            independent: [
                { text: 'Напишите сочинение по прочитанному произведению', answer: 'Творческое задание' }
            ],
            control: [
                { text: 'Сочинение на заданную тему', answer: 'Оценивается' }
            ]
        }
    },
    // ==================== ОКРУЖАЮЩИЙ МИР ====================
    'Окружающий мир': {
        '1класс': {
            test: [
                { text: 'Что такое природа?', answer: 'всё, что нас окружает', options: ['всё окружающее', 'только растения'] },
                { text: 'Когда наступает осень?', answer: 'после лета', options: ['после лета', 'после зимы'] }
            ],
            independent: [
                { text: 'Нарисуйте времена года', answer: 'Проверка' }
            ]
        },
        '2класс': {
            test: [
                { text: 'Какие бывают растения?', answer: 'деревья, кустарники, травы', options: ['только деревья', '3 группы'] },
                { text: 'Что такое экосистема?', answer: 'сообщество живых организмов', options: ['сообщество', 'один организм'] }
            ],
            independent: [
                { text: 'Опишите сезонные изменения осенью', answer: 'Листья желтеют, птицы улетают' }
            ]
        },
        '3класс': {
            test: [
                { text: 'Природные зоны России:', answer: 'тундра, лес, степь, пустыня', options: ['4 зоны', '5 зон'] },
                { text: 'В какой зоне много снега?', answer: 'тундра', options: ['тундра', 'степь', 'пустыня'] }
            ],
            independent: [
                { text: 'Нарисуйте карту природных зон России', answer: 'Проверка' }
            ]
        },
        '4класс': {
            test: [
                { text: 'Сколько у человека органов чувств?', answer: '5', options: ['5', '4', '6'] },
                { text: 'Какой орган отвечает за движение?', answer: 'мышцы', options: ['мышцы', 'кости', 'сердце'] }
            ],
            independent: [
                { text: 'Нарисуйте схему пищеварения', answer: 'Проверка' }
            ]
        }
    }
};

// ==================== ФУНКЦИИ ГЕНЕРАЦИИ ====================

// Найти задания по теме с учётом класса
function findTasksForTopic(classLevel, subject, topic, type) {
    const topicLower = topic.toLowerCase();
    const classKey = classLevel + 'класс';
    
    // 1. Ищем в базе с учётом класса
    if (taskDatabase[subject]) {
        // Сначала ищем по классу
        if (taskDatabase[subject][classKey]) {
            const classTasks = taskDatabase[subject][classKey];
            for (const [key, tasks] of Object.entries(classTasks)) {
                if (key === 'default') continue;
                if (topicLower.includes(key) || key.includes(topicLower)) {
                    return tasks[type] || tasks['test'] || tasks['independent'];
                }
            }
        }
        
        // Потом ищем универсальные для предмета
        for (const [key, tasks] of Object.entries(taskDatabase[subject])) {
            if (key === 'default' || key.includes('класс')) continue;
            if (topicLower.includes(key) || key.includes(topicLower)) {
                return tasks[type] || tasks['test'] || tasks['independent'];
            }
        }
        
        // Ищем по ключевым словам
        const keywords = topicLower.split(/[\s,.-]+/).filter(k => k.length > 2);
        for (const keyword of keywords) {
            for (const [key, tasks] of Object.entries(taskDatabase[subject])) {
                if (key === 'default' || key.includes('класс')) continue;
                if (key.includes(keyword)) {
                    return tasks[type] || tasks['test'] || tasks['independent'];
                }
            }
        }
    }
    
    // 2. Ищем в default для любого предмета
    for (const [subj, data] of Object.entries(taskDatabase)) {
        for (const [key, tasks] of Object.entries(data)) {
            if (key === 'default') continue;
            if (topicLower.includes(key) || key.includes(topicLower)) {
                return tasks[type] || tasks['test'] || tasks['independent'];
            }
        }
    }
    
    return null;
}

// Генерация уникальных заданий для всех вариантов
function generateUniqueTasksGlobal(classLevel, subject, topic, type, count, variantIndex = 0) {
    let tasks = findTasksForTopic(classLevel, subject, topic, type);
    
    if (!tasks || tasks.length === 0) {
        tasks = generateUniversalTasks(topic, type, count * 10);
    }
    
    // Копируем и перемешиваем
    let shuffled = shuffleArray([...tasks]);
    
    // Чем больше индекс варианта, тем больше перемешиваний для разнообразия
    for (let i = 0; i < variantIndex * 10; i++) {
        shuffled = shuffleArray(shuffled);
    }
    
    // Берём нужное количество заданий
    const result = shuffled.slice(0, count);
    
    // Если заданий меньше чем нужно - добавляем универсальные
    if (result.length < count) {
        const universal = generateUniversalTasks(topic, type, count - result.length);
        result.push(...universal.slice(0, count - result.length));
    }
    
    return shuffleArray(result);
}

// Генерация уникальных заданий - повторение только 1 раз если мало заданий
function generateUniqueTasks(classLevel, subject, topic, type, count, variantIndex = 0) {
    let tasks = findTasksForTopic(classLevel, subject, topic, type);
    
    if (!tasks || tasks.length === 0) {
        tasks = generateUniversalTasks(topic, type, count);
    }
    
    // Перемешиваем исходный массив
    let shuffled = shuffleArray([...tasks]);
    
    // Дополнительное перемешивание для разных вариантов
    if (variantIndex > 0) {
        for (let i = 0; i < variantIndex * 5; i++) {
            shuffled = shuffleArray(shuffled);
        }
    }
    
    const result = [];
    const usedTexts = new Set();
    
    // Первый проход - добавляем уникальные задания
    for (const task of shuffled) {
        if (result.length >= count) break;
        if (!usedTexts.has(task.text)) {
            result.push(task);
            usedTexts.add(task.text);
        }
    }
    
    // Если мало заданий - можно повторить только ОДИН раз
    if (result.length < count && shuffled.length > 0) {
        const uniqueOriginal = new Set(shuffled.map(t => t.text));
        
        // Второй проход - добавляем задания которых ещё не было (можно 1 раз повторить)
        for (const task of shuffled) {
            if (result.length >= count) break;
            if (!usedTexts.has(task.text)) {
                result.push(task);
                usedTexts.add(task.text);
            }
        }
    }
    
    // Если всё ещё мало - добавляем универсальные
    if (result.length < count) {
        const more = generateUniversalTasks(topic, type, count - result.length);
        for (const task of more) {
            if (result.length >= count) break;
            if (!usedTexts.has(task.text)) {
                result.push(task);
                usedTexts.add(task.text);
            }
        }
    }
    
    // Финальное перемешивание
    return shuffleArray(result);
}

// Определение типа задач по теме
function getTaskTypeForTopic(topic) {
    const topicLower = topic.toLowerCase();
    
    // Геометрия - треугольники
    if (topicLower.includes('треугольник') || topicLower.includes('угол') || topicLower.includes('равнобедрен') || topicLower.includes('равносторон')) {
        return 'geometry_triangles';
    }
    
    // Геометрия - четырёхугольники
    if (topicLower.includes('четырёхугольник') || topicLower.includes('квадрат') || topicLower.includes('прямоугольник') || topicLower.includes('параллелограмм') || topicLower.includes('ромб') || topicLower.includes('трапец')) {
        return 'geometry_quads';
    }
    
    // Геометрия - площадь
    if (topicLower.includes('площадь') || topicLower.includes('периметр')) {
        return 'geometry_area';
    }
    
    // Алгебра - уравнения
    if (topicLower.includes('уравнен') || topicLower.includes('неравенств')) {
        return 'algebra_equations';
    }
    
    // Алгебра - функции
    if (topicLower.includes('функц') || topicLower.includes('график')) {
        return 'algebra_functions';
    }
    
    // Алгебра - степени
    if (topicLower.includes('степен') || topicLower.includes('корен') || topicLower.includes('квадратн')) {
        return 'algebra_powers';
    }
    
    // Физика
    if (topicLower.includes('скорост') || topicLower.includes('путь') || topicLower.includes('время') || topicLower.includes('сила') || topicLower.includes('масс') || topicLower.includes('энерг')) {
        return 'physics';
    }
    
    // По умолчанию - базовые операции
    return 'basic';
}

// Генерация задач по геометрии (треугольники)
function generateGeometryTriangleTasks(topic, type, count) {
    const tasks = [];
    
    for (let i = 0; i < count; i++) {
        // Генерируем задачи про треугольники
        const angle1 = Math.floor(Math.random() * 60) + 30; // 30-90
        const isIsosceles = Math.random() > 0.5;
        
        let question, answer;
        
        if (isIsosceles) {
            // Равнобедренный треугольник - углы при основании равны
            const baseAngle = Math.floor(Math.random() * 40) + 20; // 20-60
            const vertexAngle = 180 - 2 * baseAngle;
            
            if (Math.random() > 0.5) {
                question = `В равнобедренном треугольнике угол при вершине равен ${vertexAngle}°. Чему равны углы при основании?`;
                answer = `По ${baseAngle}° каждый`;
            } else {
                question = `В равнобедренном треугольнике угол при основании равен ${baseAngle}°. Чему равен угол при вершине?`;
                answer = `${vertexAngle}°`;
            }
        } else {
            // Произвольный треугольник
            const angle2 = Math.floor(Math.random() * (180 - angle1 - 20)) + 10;
            const angle3 = 180 - angle1 - angle2;
            
            if (Math.random() > 0.5) {
                question = `В треугольнике два угла равны ${angle1}° и ${angle2}°. Чему равен третий угол?`;
                answer = `${angle3}°`;
            } else {
                question = `Чему равен третий угол треугольника, если сумма двух других ${angle1 + angle2}°?`;
                answer = `${180 - (angle1 + angle2)}°`;
            }
        }
        
        if (type === 'test') {
            const options = [
                answer,
                `${Math.floor(Math.random() * 30 + 10)}°`,
                `${Math.floor(Math.random() * 30 + 50)}°`,
                `${Math.floor(Math.random() * 30 + 80)}°`
            ];
            tasks.push({
                text: `${i + 1}. ${question}`,
                answer: answer,
                options: shuffleArray(options)
            });
        } else {
            tasks.push({
                text: `${i + 1}. ${question}`,
                answer: answer
            });
        }
    }
    
    return tasks;
}

// Генерация задач по алгебре (уравнения)
function generateAlgebraTasks(topic, type, count) {
    const tasks = [];
    
    for (let i = 0; i < count; i++) {
        // Генерируем простые линейные уравнения
        const x = Math.floor(Math.random() * 20) + 1;
        const a = Math.floor(Math.random() * 9) + 2;
        const b = Math.floor(Math.random() * 20) + 1;
        const c = a * x + b;
        
        let question, answer;
        
        if (Math.random() > 0.5) {
            question = `Решите уравнение: ${a}x + ${b} = ${c}`;
            answer = `x = ${x}`;
        } else {
            question = `Найдите x: ${a}x = ${c - b}`;
            answer = `x = ${x}`;
        }
        
        if (type === 'test') {
            const options = [
                `x = ${x}`,
                `x = ${x + Math.floor(Math.random() * 5 + 1)}`,
                `x = ${Math.max(1, x - Math.floor(Math.random() * 5 + 1))}`,
                `x = ${Math.floor(Math.random() * 10 + 5)}`
            ];
            tasks.push({
                text: `${i + 1}. ${question}`,
                answer: answer,
                options: shuffleArray(options)
            });
        } else {
            tasks.push({
                text: `${i + 1}. ${question}`,
                answer: answer
            });
        }
    }
    
    return tasks;
}

// Генерация базовых математических задач
function generateBasicTasks(topic, type, count) {
    const tasks = [];
    const operations = ['+', '-', '×', ':'];
    
    for (let i = 0; i < count; i++) {
        const op = operations[Math.floor(Math.random() * operations.length)];
        let a = Math.floor(Math.random() * 90) + 10;
        let b = Math.floor(Math.random() * 9) + 2;
        let answer, question;
        
        switch(op) {
            case '+':
                answer = a + b;
                question = `${a} + ${b} = ?`;
                break;
            case '-':
                if (a < b) [a, b] = [b, a];
                answer = a - b;
                question = `${a} - ${b} = ?`;
                break;
            case '×':
                a = Math.floor(Math.random() * 20) + 2;
                b = Math.floor(Math.random() * 9) + 2;
                answer = a * b;
                question = `${a} × ${b} = ?`;
                break;
            case ':':
                b = Math.floor(Math.random() * 8) + 2;
                answer = Math.floor(Math.random() * 10) + 2;
                a = b * answer;
                question = `${a} : ${b} = ?`;
                break;
        }
        
        const wrongAnswers = [answer + Math.floor(Math.random() * 5) + 1, 
                            answer - Math.floor(Math.random() * 5) - 1,
                            answer + Math.floor(Math.random() * 3) + 3];
        
        const options = shuffleArray([answer, ...wrongAnswers.filter(a => a > 0)].slice(0, 4));
        
        if (type === 'test') {
            tasks.push({
                text: `${i + 1}. ${question}`,
                answer: String(answer),
                options: options.map(String)
            });
        } else {
            tasks.push({
                text: `${i + 1}. ${question}`,
                answer: String(answer)
            });
        }
    }
    
    return tasks;
}

// Основная функция генерации заданий
function generateUniversalTasks(topic, type, count) {
    const taskType = getTaskTypeForTopic(topic);
    
    switch(taskType) {
        case 'geometry_triangles':
            return generateGeometryTriangleTasks(topic, type, count);
        case 'algebra_equations':
            return generateAlgebraTasks(topic, type, count);
        default:
            return generateBasicTasks(topic, type, count);
    }
}

// Перемешивание массива (Fisher-Yates)
function shuffleArray(array) {
    const arr = [...array];
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

// ==================== БАЗА ДАННЫХ ИСПОЛЬЗОВАННЫХ ЗАДАНИЙ ====================
// Загружаем использованные задания из localStorage
let globalUsedTasks = new Set(JSON.parse(localStorage.getItem('usedTasks') || '[]'));

// Сохраняем использованные задания в localStorage
function saveUsedTasks() {
    localStorage.setItem('usedTasks', JSON.stringify([...globalUsedTasks]));
}

// Очистить историю использованных заданий
function clearUsedTasks() {
    if (confirm('Очистить историю использованных заданий? Все задания снова будут доступны.')) {
        globalUsedTasks = new Set();
        saveUsedTasks();
        alert('✅ История очищена!');
    }
}

// ==================== СОХРАНЕНИЕ ВАРИАНТОВ ====================
let savedWorksheets = JSON.parse(localStorage.getItem('savedWorksheets') || '[]');

function saveCurrentWorksheet() {
    const data = {
        id: Date.now(),
        date: new Date().toLocaleDateString('ru-RU'),
        classLevel: classSelect.value,
        subject: subjectSelect.value,
        topic: lessonTopic.value,
        section: sectionNum.value,
        name: lessonName.value,
        type: workType.value,
        taskCount: taskCount.value,
        variantCount: variantCount.value,
        content: outputContent.innerHTML,
        answers: generatedAnswers
    };
    
    savedWorksheets.push(data);
    localStorage.setItem('savedWorksheets', JSON.stringify(savedWorksheets));
    renderSavedList();
    alert('✅ Вариант сохранён!');
}

function deleteSavedWorksheet(id) {
    if (confirm('Удалить этот вариант?')) {
        savedWorksheets = savedWorksheets.filter(w => w.id !== id);
        localStorage.setItem('savedWorksheets', JSON.stringify(savedWorksheets));
        renderSavedList();
    }
}

function loadSavedWorksheet(id) {
    const worksheet = savedWorksheets.find(w => w.id === id);
    if (worksheet) {
        outputContent.innerHTML = worksheet.content;
        outputSection.style.display = 'block';
        outputSection.scrollIntoView({ behavior: 'smooth' });
    }
}

function renderSavedList() {
    const list = document.getElementById('savedList');
    
    if (!list) return;
    
    if (savedWorksheets.length === 0) {
        list.innerHTML = '<p class="empty-message">У вас пока нет сохранённых вариантов</p>';
        return;
    }
    
    list.innerHTML = savedWorksheets.map(w => `
        <div class="saved-item">
            <div class="saved-info">
                <strong>${w.subject}</strong> - ${w.topic}<br>
                <small>${w.date} | ${w.classLevel} класс | ${w.variantCount} вар.</small>
            </div>
            <div class="saved-actions">
                <button onclick="loadSavedWorksheet(${w.id})">📖 Открыть</button>
                <button onclick="deleteSavedWorksheet(${w.id})" class="delete-btn">🗑️</button>
            </div>
        </div>
    `).join('');
}

// ==================== DOM ====================
const classSelect = document.getElementById('classSelect');
const subjectSelect = document.getElementById('subjectSelect');
const lessonTopic = document.getElementById('lessonTopic');
const sectionNum = document.getElementById('sectionNum');
const lessonName = document.getElementById('lessonName');
const workType = document.getElementById('workType');
const taskCount = document.getElementById('taskCount');
const variantCount = document.getElementById('variantCount');
const generatorForm = document.getElementById('generatorForm');
const outputSection = document.getElementById('outputSection');
const outputContent = document.getElementById('outputContent');
const editBtn = document.getElementById('editBtn');
const printBtn = document.getElementById('printBtn');
const newBtn = document.getElementById('newBtn');
const saveBtn = document.getElementById('saveBtn');

let generatedAnswers = [];

// Переключение вкладок
document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const tabId = this.dataset.tab;
        
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(tabId + '-tab').classList.add('active');
        
        if (tabId === 'saved') {
            renderSavedList();
        }
    });
});

// Обновление предметов
classSelect.addEventListener('change', function() {
    const classLevel = parseInt(this.value);
    const subjects = subjectsByClass[classLevel] || [];
    
    subjectSelect.innerHTML = '<option value="">Выберите предмет</option>';
    subjects.forEach(subject => {
        const option = document.createElement('option');
        option.value = subject;
        option.textContent = subject;
        subjectSelect.appendChild(option);
    });
    subjectSelect.disabled = false;
});

generatorForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const selectedClass = parseInt(classSelect.value);
    const subject = subjectSelect.value;
    const topic = lessonTopic.value;
    const section = sectionNum.value;
    const name = lessonName.value;
    const type = workType.value;
    const count = parseInt(taskCount.value);
    const variants = parseInt(variantCount.value);
    
    // Находим все доступные задания
    let allTasks = findTasksForTopic(selectedClass, subject, topic, type);
    if (!allTasks || allTasks.length === 0) {
        allTasks = generateUniversalTasks(topic, type, 50);
    }
    
    // Перемешиваем все задания
    let shuffledAll = shuffleArray([...allTasks]);
    
    // Если заданий меньше чем нужно на все варианты - добавляем универсальные
    const totalNeeded = count * variants;
    while (shuffledAll.length < totalNeeded) {
        shuffledAll = shuffledAll.concat(generateUniversalTasks(topic, type, 10));
    }
    shuffledAll = shuffleArray(shuffledAll);
    
    let html = '';
    let allAnswers = [];
    let usedInSession = new Set(); // Отслеживаем использованные в этой сессии
    
    for (let v = 1; v <= variants; v++) {
        const variantLetter = getVariantLetter(v);
        
        // Выбираем задания которые ещё НЕ использовались в этой сессии
        const availableTasks = shuffledAll.filter(t => !usedInSession.has(t.text));
        
        // Если мало - берём любые
        const tasksForVariant = availableTasks.length >= count 
            ? shuffleArray(availableTasks).slice(0, count)
            : shuffleArray(shuffledAll).slice(0, count);
        
        // Добавляем в использованные
        tasksForVariant.forEach(t => usedInSession.add(t.text));
        
        html += generateWorksheetHTML(selectedClass, subject, topic, section, name, type, tasksForVariant, v, variantLetter);
        allAnswers.push({ variant: v, letter: variantLetter, answers: tasksForVariant.map(t => t.answer) });
    }
    
    outputContent.innerHTML = html;
    outputSection.style.display = 'block';
    generatedAnswers = allAnswers;
    outputSection.scrollIntoView({ behavior: 'smooth' });
});

function getVariantLetter(num) {
    const letters = 'АБВГДЕЁЖЗИКЛМНОПРСТУФХЦЧШЩЭЮЯ';
    return letters[(num - 1) % letters.length];
}

function generateWorksheetHTML(classLevel, subject, topic, section, name, type, tasks, variantNum, variantLetter) {
    const typeNames = {
        'test': 'Тест',
        'independent': 'Самостоятельная работа',
        'control': 'Контрольная работа'
    };
    
    let sectionInfo = section ? `<div class="worksheet-info"><strong>§ / Пункт:</strong> ${section}</div>` : '';
    
    let html = `
        <div class="worksheet">
            <div class="worksheet-header">
                <div class="worksheet-title">${typeNames[type]} - Вариант ${variantLetter}</div>
                <div class="worksheet-info"><strong>Предмет:</strong> ${subject}</div>
                <div class="worksheet-info"><strong>Класс:</strong> ${classLevel}</div>
                <div class="worksheet-info"><strong>Тема:</strong> ${topic}</div>
                ${sectionInfo}
                <div class="worksheet-info"><strong>Урок:</strong> ${name}</div>
                <div class="worksheet-info"><strong>Дата:</strong> ${new Date().toLocaleDateString('ru-RU')}</div>
            </div>
            <ul class="task-list">
    `;
    
    tasks.forEach((task, index) => {
        const cleanText = task.text.replace(/^\d+\.\s*/, '');
        
        if (type === 'test' && task.options) {
            let optionsHTML = task.options.map((opt, i) => `
                <div class="test-option">
                    <input type="radio" name="v${variantLetter}_t${index}" id="v${variantLetter}_t${index}_${i}">
                    <label for="v${variantLetter}_t${index}_${i}">${opt}</label>
                </div>
            `).join('');
            
            html += `
                <li class="task-item">
                    <span class="task-text">${index + 1}. ${cleanText}</span>
                    ${task.textFull ? `<div class="task-text-full"><em>${task.textFull}</em></div>` : ''}
                    <div class="test-options">${optionsHTML}</div>
                </li>
            `;
        } else {
            html += `
                <li class="task-item">
                    <span class="task-text">${index + 1}. ${cleanText}</span>
                    ${task.textFull ? `<div class="task-text-full"><em>${task.textFull}</em></div>` : ''}
                </li>
            `;
        }
    });
    
    html += `
            </ul>
            <div class="answer-section">
                <h3>Ответы - Вариант ${variantLetter} (для учителя)</h3>
                <ul class="answer-list">
    `;
    
    tasks.forEach((task, index) => {
        html += `<li class="answer-item">${index + 1}. ${task.answer}</li>`;
    });
    
    html += `
                </ul>
            </div>
        </div>
    `;
    
    return html;
}

// Кнопки
let isEditing = false;

editBtn.addEventListener('click', function() {
    isEditing = !isEditing;
    outputContent.contentEditable = isEditing;
    editBtn.textContent = isEditing ? '💾 Сохранить' : '✏️ Редактировать';
    if (!isEditing) outputContent.blur();
    else outputContent.focus();
});

printBtn.addEventListener('click', () => window.print());
saveBtn.addEventListener('click', saveCurrentWorksheet);

newBtn.addEventListener('click', () => {
    outputSection.style.display = 'none';
    generatorForm.reset();
    subjectSelect.innerHTML = '<option value="">Сначала выберите класс</option>';
    subjectSelect.disabled = true;
});

// Инициализация
renderSavedList();
